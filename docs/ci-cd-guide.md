# CI/CD æµæ°´çº¿ä½¿ç”¨æŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•ä½¿ç”¨åŸºäº [rust-ci](https://gitlab.com/rust-ci/rust-ci) é¡¹ç›®çš„é«˜æ•ˆ CI/CD æµæ°´çº¿ã€‚

## ğŸ“‹ ç›®å½•

- [æ¦‚è¿°](#æ¦‚è¿°)
- [æµæ°´çº¿é˜¶æ®µ](#æµæ°´çº¿é˜¶æ®µ)
- [æŒ‰ Executor åˆ†åŒ…](#æŒ‰-executor-åˆ†åŒ…)
- [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
- [ä½¿ç”¨æ–¹æ³•](#ä½¿ç”¨æ–¹æ³•)
- [ä¼˜åŒ–å»ºè®®](#ä¼˜åŒ–å»ºè®®)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

## æ¦‚è¿°

æœ¬é¡¹ç›®ä½¿ç”¨ GitLab CI/CD è¿›è¡ŒæŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²ã€‚æµæ°´çº¿é…ç½®åŸºäº [rust-ci](https://gitlab.com/rust-ci/rust-ci) é¡¹ç›®çš„æœ€ä½³å®è·µï¼Œå¹¶é’ˆå¯¹å¤š crate workspace é¡¹ç›®è¿›è¡Œäº†ä¼˜åŒ–ã€‚

**æ³¨æ„**ï¼šæœ¬é¡¹ç›®çš„ CI/CD é…ç½®æ˜¯å®Œå…¨æœ¬åœ°åŒ–çš„ï¼Œä¸ä¾èµ–ä»»ä½•è¿œç«¯èµ„æºï¼Œæ‰€æœ‰ä½œä¸šå’Œå·¥å…·éƒ½åœ¨æœ¬åœ°å®šä¹‰å’Œå®‰è£…ã€‚

### ä¸»è¦ç‰¹æ€§

- âœ… **å¹¶è¡Œæ‰§è¡Œ**ï¼šå¤šä¸ª crate çš„æµ‹è¯•å’Œæ„å»ºå¹¶è¡Œæ‰§è¡Œï¼Œæé«˜æ•ˆç‡
- âœ… **æ™ºèƒ½ç¼“å­˜**ï¼šç¼“å­˜ Cargo ä¾èµ–å’Œç¼–è¯‘äº§ç‰©ï¼ŒåŠ é€Ÿåç»­æ„å»º
- âœ… **å¢é‡æ£€æŸ¥**ï¼šåªå¯¹å˜æ›´çš„æ–‡ä»¶è¿è¡Œç›¸å…³æ£€æŸ¥
- âœ… **å¤šé˜¶æ®µéªŒè¯**ï¼šæ ¼å¼æ£€æŸ¥ã€ä»£ç æ£€æŸ¥ã€æµ‹è¯•ã€æ„å»ºã€æ‰“åŒ…
- âœ… **è¦†ç›–ç‡æŠ¥å‘Š**ï¼šè‡ªåŠ¨ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
- âœ… **å‘å¸ƒç®¡ç†**ï¼šè‡ªåŠ¨æ‰“åŒ…å’Œéƒ¨ç½²

## æµæ°´çº¿é˜¶æ®µ

### 1. Validateï¼ˆéªŒè¯é˜¶æ®µï¼‰

éªŒè¯é¡¹ç›®é…ç½®å’Œä¾èµ–çš„å®Œæ•´æ€§ã€‚

- **validate:cargo-toml**ï¼šéªŒè¯ Cargo.toml æ ¼å¼
- **validate:dependencies**ï¼šéªŒè¯ä¾èµ–å®Œæ•´æ€§

### 2. Lintï¼ˆä»£ç æ£€æŸ¥é˜¶æ®µï¼‰

æ£€æŸ¥ä»£ç è´¨é‡å’Œæ ¼å¼ã€‚

- **lint:fmt**ï¼šæ£€æŸ¥ä»£ç æ ¼å¼ï¼ˆ`cargo fmt --check`ï¼‰
- **lint:clippy**ï¼šè¿è¡Œ Clippy ä»£ç æ£€æŸ¥
- **lint:clippy:***ï¼šé’ˆå¯¹å„ä¸ª crate çš„å¹¶è¡Œ Clippy æ£€æŸ¥

### 3. Testï¼ˆæµ‹è¯•é˜¶æ®µï¼‰

è¿è¡Œå„ç§æµ‹è¯•ã€‚

- **test:all**ï¼šè¿è¡Œæ‰€æœ‰æµ‹è¯•
- **test:unit:***ï¼šé’ˆå¯¹å„ä¸ª crate çš„å•å…ƒæµ‹è¯•ï¼ˆå¹¶è¡Œæ‰§è¡Œï¼‰
- **test:integration**ï¼šé›†æˆæµ‹è¯•
- **test:doc**ï¼šæ–‡æ¡£æµ‹è¯•

### 4. Buildï¼ˆæ„å»ºé˜¶æ®µï¼‰

ç¼–è¯‘é¡¹ç›®ã€‚

- **build:debug**ï¼šDebug æ¨¡å¼æ„å»º
- **build:release**ï¼šRelease æ¨¡å¼æ„å»ºï¼ˆé’ˆå¯¹è¾¹ç¼˜éƒ¨ç½²ä¼˜åŒ–ï¼‰
- **build:release:***ï¼šé’ˆå¯¹å„ä¸ª crate çš„ Release æ„å»ºï¼ˆå¹¶è¡Œæ‰§è¡Œï¼‰
- **build:release:binary**ï¼šæ„å»ºä¸»ç¨‹åºäºŒè¿›åˆ¶æ–‡ä»¶

### 5. Packageï¼ˆæ‰“åŒ…é˜¶æ®µï¼‰

åˆ›å»ºå‘å¸ƒåŒ…ã€‚

- **package:release**ï¼šåˆ›å»ºå‹ç¼©åŒ…ï¼ŒåŒ…å«æ‰€æœ‰äºŒè¿›åˆ¶æ–‡ä»¶å’Œåº“æ–‡ä»¶

### 7. Analyzeï¼ˆåˆ†æé˜¶æ®µï¼‰

åˆ†æä¾èµ–å’ŒåŒ…ä½“ç§¯ã€‚

- **analyze:dependencies:***ï¼šåˆ†æå„ä¸ª executor çš„ä¾èµ–
- **analyze:size**ï¼šåˆ†æåŒ…ä½“ç§¯

### 8. Packageï¼ˆæ‰“åŒ…é˜¶æ®µï¼‰

ä¸ºæ¯ä¸ª executor åˆ›å»ºç‹¬ç«‹çš„å‘å¸ƒåŒ…ã€‚

- **package:core**ï¼šæ ¸å¿ƒåº“åŒ…
- **package:cpp**ï¼šC++ Executor åŒ…
- **package:ml:***ï¼šML Executor åŒ…ï¼ˆCPUã€CUDAã€Metal ç­‰å˜ä½“ï¼‰
- **package:python:***ï¼šPython Executor åŒ…ï¼ˆBaseã€Pythonã€WASMã€Full ç­‰å˜ä½“ï¼‰

### 9. Deployï¼ˆéƒ¨ç½²é˜¶æ®µï¼‰

éƒ¨ç½²åˆ°ä¸åŒç¯å¢ƒï¼ˆå¯é€‰ï¼‰ã€‚

- **deploy:staging**ï¼šéƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
- **deploy:production**ï¼šéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

## æŒ‰ Executor åˆ†åŒ…

### åˆ†åŒ…ç­–ç•¥

æœ¬é¡¹ç›®æ”¯æŒä¸ºä¸åŒçš„ executor åˆ›å»ºç‹¬ç«‹çš„ä¾èµ–åŒ…ï¼Œå®ç°æ¨¡å—åŒ–éƒ¨ç½²ï¼š

#### 1. æ ¸å¿ƒåº“åŒ… (`rust-edge-compute-core`)
- **ç”¨é€”**ï¼šæ‰€æœ‰ executor å…±äº«çš„åŸºç¡€åº“
- **å†…å®¹**ï¼šæ ¸å¿ƒåº“çš„ `.rlib` å’Œ `.so` æ–‡ä»¶
- **ä¾èµ–**ï¼šåŸºç¡€ä¾èµ–ï¼ˆtokioã€serde ç­‰ï¼‰

#### 2. C++ Executor åŒ… (`rust-edge-compute-cpp`)
- **ç”¨é€”**ï¼šC++ ç®—æ³•æ‰§è¡Œå™¨
- **å†…å®¹**ï¼š
  - åº“æ–‡ä»¶ï¼ˆ`.so`, `.rlib`ï¼‰
  - C++ å¤´æ–‡ä»¶ï¼ˆ`cpp_bridge.h`, `json_parser.h`ï¼‰
  - ä¾èµ–åˆ—è¡¨
- **ç‰¹æ€§**ï¼šæ”¯æŒ `fftw` ç‰¹æ€§ï¼ˆå¯é€‰ï¼‰

#### 3. ML Executor åŒ… (`rust-edge-compute-ml`)
- **ç”¨é€”**ï¼šæœºå™¨å­¦ä¹ æ¨¡å‹æ¨ç†æ‰§è¡Œå™¨
- **å†…å®¹**ï¼š
  - åº“æ–‡ä»¶
  - ä¾èµ–åˆ—è¡¨
- **å˜ä½“**ï¼š
  - **CPU ç‰ˆæœ¬**ï¼šåŸºç¡€ç‰ˆæœ¬ï¼Œæ—  GPU æ”¯æŒ
  - **CUDA ç‰ˆæœ¬**ï¼šæ”¯æŒ NVIDIA GPUï¼ˆéœ€è¦æ‰‹åŠ¨è§¦å‘ï¼‰
  - **Metal ç‰ˆæœ¬**ï¼šæ”¯æŒ Apple Metalï¼ˆéœ€è¦æ‰‹åŠ¨è§¦å‘ï¼‰

#### 4. Python Executor åŒ… (`rust-edge-compute-python`)
- **ç”¨é€”**ï¼šPython å’Œ WASM æ‰§è¡Œå™¨
- **å†…å®¹**ï¼š
  - åº“æ–‡ä»¶
  - Python æ¨¡å—ï¼ˆå¦‚æœå¯ç”¨ `python` ç‰¹æ€§ï¼‰
  - WASM æ¨¡å—ï¼ˆå¦‚æœå¯ç”¨ `wasm` ç‰¹æ€§ï¼‰
  - ä¾èµ–åˆ—è¡¨
- **å˜ä½“**ï¼š
  - **Base ç‰ˆæœ¬**ï¼šåŸºç¡€ç‰ˆæœ¬ï¼Œæ— ç‰¹æ€§
  - **Python ç‰ˆæœ¬**ï¼šæ”¯æŒ Python æ‰§è¡Œ
  - **WASM ç‰ˆæœ¬**ï¼šæ”¯æŒ WASM æ‰§è¡Œ
  - **Full ç‰ˆæœ¬**ï¼šPython + WASMï¼ˆéœ€è¦æ‰‹åŠ¨è§¦å‘ï¼‰

### åŒ…ç»“æ„ç¤ºä¾‹

```
dist/
â”œâ”€â”€ rust-edge-compute-core-{version}.tar.gz
â”œâ”€â”€ rust-edge-compute-cpp-{version}.tar.gz
â”‚   â””â”€â”€ rust-edge-compute-cpp-{version}/
â”‚       â”œâ”€â”€ lib/
â”‚       â”‚   â”œâ”€â”€ librust_edge_compute_cpp.so
â”‚       â”‚   â””â”€â”€ librust_edge_compute_cpp.rlib
â”‚       â”œâ”€â”€ include/
â”‚       â”‚   â”œâ”€â”€ cpp_bridge.h
â”‚       â”‚   â””â”€â”€ json_parser.h
â”‚       â”œâ”€â”€ README.md
â”‚       â”œâ”€â”€ LICENSE
â”‚       â”œâ”€â”€ VERSION
â”‚       â””â”€â”€ dependencies.txt
â”œâ”€â”€ rust-edge-compute-ml-{version}-cpu.tar.gz
â”œâ”€â”€ rust-edge-compute-ml-{version}-cuda.tar.gz
â”œâ”€â”€ rust-edge-compute-python-{version}-base.tar.gz
â”œâ”€â”€ rust-edge-compute-python-{version}-python.tar.gz
â””â”€â”€ rust-edge-compute-python-{version}-wasm.tar.gz
```

### ä½¿ç”¨åˆ†åŒ…

1. **é€‰æ‹©æ€§éƒ¨ç½²**ï¼šåªéƒ¨ç½²éœ€è¦çš„ executor
2. **ä½“ç§¯ä¼˜åŒ–**ï¼šæ¯ä¸ªåŒ…åªåŒ…å«å¿…è¦çš„ä¾èµ–
3. **ç‰ˆæœ¬ç®¡ç†**ï¼šæ¯ä¸ª executor å¯ä»¥ç‹¬ç«‹ç‰ˆæœ¬ç®¡ç†
4. **ç‰¹æ€§ç»„åˆ**ï¼šæ”¯æŒä¸åŒçš„ç‰¹æ€§ç»„åˆï¼ˆå¦‚ CUDAã€Metal ç­‰ï¼‰

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

æµæ°´çº¿ä½¿ç”¨ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```yaml
RUST_VERSION: "stable"              # Rust å·¥å…·é“¾ç‰ˆæœ¬
CARGO_HOME: "${CI_PROJECT_DIR}/.cargo"  # Cargo ä¸»ç›®å½•
CARGO_BUILD_JOBS: "4"                # å¹¶è¡Œç¼–è¯‘çº¿ç¨‹æ•°
CARGO_INCREMENTAL: "0"               # ç¦ç”¨å¢é‡ç¼–è¯‘
```

### ç¼“å­˜é…ç½®

æµæ°´çº¿é…ç½®äº†å¤šå±‚ç¼“å­˜ä»¥åŠ é€Ÿæ„å»ºï¼š

- **Cargo æ³¨å†Œè¡¨ç¼“å­˜**ï¼šç¼“å­˜ä¸‹è½½çš„ä¾èµ–åŒ…
- **Cargo Git ç¼“å­˜**ï¼šç¼“å­˜ Git ä¾èµ–
- **Target ç¼“å­˜**ï¼šç¼“å­˜ç¼–è¯‘äº§ç‰©

### è§¦å‘è§„åˆ™

- **æ‰€æœ‰é˜¶æ®µ**ï¼šé»˜è®¤åœ¨ä»£ç å˜æ›´æ—¶è§¦å‘
- **Release æ„å»º**ï¼šä»…åœ¨ main/master åˆ†æ”¯å’Œ tags æ—¶è§¦å‘
- **æ‰“åŒ…**ï¼šä»…åœ¨ tags å’Œ main/master åˆ†æ”¯æ—¶è§¦å‘
- **éƒ¨ç½²**ï¼šæ‰‹åŠ¨è§¦å‘ï¼ˆ`when: manual`ï¼‰

### è·³è¿‡ CI

å¦‚æœæäº¤ä¿¡æ¯åŒ…å« `[skip ci]` æˆ– `[ci skip]`ï¼Œæµæ°´çº¿å°†ä¸ä¼šè¿è¡Œã€‚

## ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬ä½¿ç”¨

å°† `.gitlab-ci.yml` æ–‡ä»¶æäº¤åˆ°ä»“åº“åï¼ŒGitLab ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶è¿è¡Œæµæ°´çº¿ã€‚

```bash
# æäº¤ä»£ç 
git add .gitlab-ci.yml
git commit -m "Add CI/CD pipeline"
git push origin main
```

### 2. æŸ¥çœ‹æµæ°´çº¿çŠ¶æ€

1. åœ¨ GitLab é¡¹ç›®ä¸­ï¼Œç‚¹å‡»å·¦ä¾§è¾¹æ çš„ **CI/CD** > **æµæ°´çº¿**
2. æŸ¥çœ‹æµæ°´çº¿çŠ¶æ€å’Œå„ä¸ªä½œä¸šçš„æ‰§è¡Œæƒ…å†µ
3. ç‚¹å‡»ä½œä¸šåç§°æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

### 3. æ‰‹åŠ¨è§¦å‘éƒ¨ç½²

1. åœ¨æµæ°´çº¿é¡µé¢ï¼Œæ‰¾åˆ° `deploy:staging` æˆ– `deploy:production` ä½œä¸š
2. ç‚¹å‡»ä½œä¸šå³ä¾§çš„ **â–¶ï¸** æŒ‰é’®æ‰‹åŠ¨è§¦å‘

### 4. æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡

1. åœ¨æµæ°´çº¿é¡µé¢ï¼Œæ‰¾åˆ° `test:all` ä½œä¸š
2. æŸ¥çœ‹ä½œä¸šè¯¦æƒ…ä¸­çš„è¦†ç›–ç‡æŠ¥å‘Š

### 5. ä¸‹è½½æ„å»ºäº§ç‰©

1. åœ¨æµæ°´çº¿é¡µé¢ï¼Œæ‰¾åˆ°æ„å»ºä½œä¸šï¼ˆå¦‚ `build:release`ï¼‰
2. ç‚¹å‡» **æµè§ˆ** æŒ‰é’®ä¸‹è½½æ„å»ºäº§ç‰©

## ä¼˜åŒ–å»ºè®®

### 1. ä½¿ç”¨å…±äº« Runner

å¦‚æœé¡¹ç›®ä½¿ç”¨ GitLab.com çš„å…±äº« Runnerï¼Œå»ºè®®ï¼š

- é…ç½®é¡¹ç›®ä¸“ç”¨çš„ Runner ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½
- ä½¿ç”¨è‡ªæ‰˜ç®¡çš„ Runner ä»¥èŠ‚çœ CI åˆ†é’Ÿæ•°

### 2. è°ƒæ•´å¹¶è¡Œåº¦

æ ¹æ® Runner çš„èµ„æºæƒ…å†µï¼Œè°ƒæ•´ `CARGO_BUILD_JOBS`ï¼š

```yaml
variables:
  CARGO_BUILD_JOBS: "8"  # æ ¹æ® Runner CPU æ ¸å¿ƒæ•°è°ƒæ•´
```

### 3. ä¼˜åŒ–ç¼“å­˜ç­–ç•¥

- ä½¿ç”¨ `key: ${CI_COMMIT_REF_SLUG}` ä¸ºä¸åŒåˆ†æ”¯åˆ›å»ºç‹¬ç«‹ç¼“å­˜
- å®šæœŸæ¸…ç†è¿‡æœŸç¼“å­˜

### 4. ä½¿ç”¨ Docker é•œåƒç¼“å­˜

å¦‚æœä½¿ç”¨è‡ªå®šä¹‰ Docker é•œåƒï¼Œå»ºè®®ï¼š

- åœ¨ Dockerfile ä¸­ä½¿ç”¨å¤šé˜¶æ®µæ„å»º
- å°†ä¾èµ–å®‰è£…å’Œä»£ç ç¼–è¯‘åˆ†ç¦»
- ä½¿ç”¨ Docker å±‚ç¼“å­˜

### 5. æ¡ä»¶æ‰§è¡Œ

æ ¹æ®é¡¹ç›®éœ€æ±‚ï¼Œå¯ä»¥æ·»åŠ æ¡ä»¶æ‰§è¡Œè§„åˆ™ï¼š

```yaml
only:
  changes:
    - "rust-edge-compute-core/**/*"
    - "Cargo.toml"
```

## æ•…éšœæ’é™¤

### 1. æµæ°´çº¿å¤±è´¥

**é—®é¢˜**ï¼šæµæ°´çº¿åœ¨æŸä¸ªä½œä¸šå¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æŸ¥çœ‹ä½œä¸šæ—¥å¿—ï¼Œæ‰¾åˆ°é”™è¯¯ä¿¡æ¯
- æ£€æŸ¥ä»£ç æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯
- æ£€æŸ¥ä¾èµ–æ˜¯å¦æ­£ç¡®é…ç½®
- æ£€æŸ¥ Runner æ˜¯å¦æœ‰è¶³å¤Ÿçš„èµ„æº

### 2. ç¼“å­˜é—®é¢˜

**é—®é¢˜**ï¼šç¼“å­˜å¯¼è‡´æ„å»ºé—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ¸…é™¤ç¼“å­˜ï¼šåœ¨ CI/CD è®¾ç½®ä¸­æ¸…é™¤ç¼“å­˜
- æ›´æ–°ç¼“å­˜é”®ï¼šä¿®æ”¹ `cache.key` å¼ºåˆ¶åˆ·æ–°ç¼“å­˜

### 3. æ„å»ºè¶…æ—¶

**é—®é¢˜**ï¼šæ„å»ºä½œä¸šè¶…æ—¶

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å¢åŠ ä½œä¸šè¶…æ—¶æ—¶é—´
- ä¼˜åŒ–æ„å»ºé…ç½®ï¼ˆå‡å°‘å¹¶è¡Œåº¦ã€ç¦ç”¨ä¸å¿…è¦çš„ç‰¹æ€§ï¼‰
- ä½¿ç”¨æ›´å¼ºå¤§çš„ Runner

### 4. ä¾èµ–ä¸‹è½½å¤±è´¥

**é—®é¢˜**ï¼šä¾èµ–ä¸‹è½½è¶…æ—¶æˆ–å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- ä½¿ç”¨å›½å†…é•œåƒæºï¼ˆå¦‚æ¸…åå¤§å­¦é•œåƒï¼‰
- å¢åŠ é‡è¯•æ¬¡æ•°

### 5. Clippy è­¦å‘Š

**é—®é¢˜**ï¼šClippy æ£€æŸ¥å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä¿®å¤ Clippy è­¦å‘Š
- å¦‚æœè­¦å‘Šæ˜¯è¯¯æŠ¥ï¼Œå¯ä»¥ä½¿ç”¨ `#[allow(clippy::warning_name)]` å¿½ç•¥
- ä¸´æ—¶å…è®¸å¤±è´¥ï¼šè®¾ç½® `allow_failure: true`

### 6. Cargo.lock éœ€è¦æ›´æ–°

**é—®é¢˜**ï¼š`validate:dependencies` ä½œä¸šå¤±è´¥ï¼ŒæŠ¥é”™ "the lock file needs to be updated but --locked was passed"

**åŸå› **ï¼š
- `Cargo.toml` ä¸­çš„ä¾èµ–å‘ç”Ÿäº†å˜åŒ–ï¼ˆç‰ˆæœ¬æ›´æ–°ã€æ·»åŠ æ–°ä¾èµ–ç­‰ï¼‰
- `Cargo.lock` æ–‡ä»¶æ²¡æœ‰åŒæ­¥æ›´æ–°

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. åœ¨æœ¬åœ°è¿è¡Œä»¥ä¸‹å‘½ä»¤æ›´æ–° `Cargo.lock`ï¼š
   ```bash
   cargo generate-lockfile
   ```
2. æ£€æŸ¥ `Cargo.lock` çš„æ›´æ”¹ï¼š
   ```bash
   git diff Cargo.lock
   ```
3. æäº¤æ›´æ–°åçš„ `Cargo.lock` æ–‡ä»¶ï¼š
   ```bash
   git add Cargo.lock
   git commit -m "Update Cargo.lock"
   git push
   ```

**æ³¨æ„**ï¼š
- `Cargo.lock` åº”è¯¥è¢«æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆå¯¹äºåº”ç”¨ç¨‹åºå’Œåº“é¡¹ç›®ï¼‰
- CI ä¼šè‡ªåŠ¨æ£€æµ‹ `Cargo.lock` æ˜¯å¦éœ€è¦æ›´æ–°ï¼Œå¦‚æœæ£€æµ‹åˆ°æ›´æ”¹ä¼šæŠ¥é”™ï¼Œè¦æ±‚å¼€å‘è€…æ‰‹åŠ¨æ›´æ–°å¹¶æäº¤

## é«˜çº§é…ç½®

### 1. å¤šå¹³å°æ„å»º

å¦‚æœéœ€è¦æ„å»ºå¤šä¸ªå¹³å°çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥æ·»åŠ ï¼š

```yaml
build:release:linux:
  script:
    - cargo build --target x86_64-unknown-linux-gnu --release

build:release:windows:
  script:
    - cargo build --target x86_64-pc-windows-msvc --release
```

### 2. æ€§èƒ½åŸºå‡†æµ‹è¯•

æ·»åŠ æ€§èƒ½åŸºå‡†æµ‹è¯•ï¼š

```yaml
benchmark:
  stage: test
  script:
    - cargo bench --workspace
  only:
    - main
    - master
```

### 3. å®‰å…¨æ‰«æ

æ·»åŠ å®‰å…¨æ‰«æï¼š

```yaml
security:audit:
  stage: validate
  script:
    - cargo audit
  allow_failure: true
```

### 4. ä»£ç è¦†ç›–ç‡

é…ç½®ä»£ç è¦†ç›–ç‡æŠ¥å‘Šï¼š

```yaml
test:coverage:
  stage: test
  script:
    - cargo test --workspace --all-features
    - cargo llvm-cov --workspace --lcov --output-path lcov.info
  coverage: '/^test result:.*\s+(\d+\.\d+)%.*$/'
  artifacts:
    reports:
      coverage_report:
        coverage_format: cobertura
        path: lcov.info
```

## å‚è€ƒèµ„æº

- [rust-ci é¡¹ç›®](https://gitlab.com/rust-ci/rust-ci)
- [GitLab CI/CD æ–‡æ¡£](https://docs.gitlab.com/ee/ci/)
- [Cargo æ–‡æ¡£](https://doc.rust-lang.org/cargo/)
- [Rust å·¥å…·é“¾æ–‡æ¡£](https://rust-lang.github.io/rustup/)

## æ›´æ–°æ—¥å¿—

- **2024-01-XX**ï¼šåˆå§‹ç‰ˆæœ¬ï¼ŒåŸºäº rust-ci é¡¹ç›®åˆ›å»º
- æ”¯æŒå¤š crate workspace å¹¶è¡Œæ„å»º
- ä¼˜åŒ–ç¼“å­˜ç­–ç•¥
- æ·»åŠ éƒ¨ç½²é˜¶æ®µ

